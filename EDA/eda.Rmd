---
title: "Eksploracyjna analiza danych – klasyczna"
output: "Łucja Wuls"
date: "2025-11-21"
---

```{r}
library(tidyverse)
library(skimr)
library(gridExtra)
library(grid)
library(gt)
```

```{r}
var_pl <- c(
  gdp = "PKB (USD)",
  inflation = "Inflacja (CPI, %)",
  unemployment = "Stopa bezrobocia (%)",
  tourism_arrivals = "Przyjazdy turystów (liczba)",
  tourism_receipts = "Wpływy z turystyki (USD)",
  tourism_expenditures = "Wydatki turystyczne (USD)",
  tourism_exports = "Eksport usług turystycznych (USD)",
  tourism_departures = "Wyjazdy turystów (liczba)"
)

label_var <- function(x) dplyr::recode(x, !!!var_pl, .default = x)


var_scale <- c(
  gdp = 1e9,
  tourism_receipts = 1e9,
  tourism_arrivals = 1e6,
  tourism_departures = 1e6,
  inflation = 1,
  unemployment = 1,
  tourism_expenditures = 1,
  tourism_exports = 1
)
```

```{r}
kolor_blekit <- "#7ea1ed"  
kolor_granat <- "#3f51b5" 

theme_inz <- function() {
  theme_minimal(base_size = 11) +
    theme(
      plot.title = element_text(face = "bold", size = 14, color = "#2c3e50"),
      plot.subtitle = element_text(size = 10, color = "#546e7a", margin = margin(b = 15)),
      strip.background = element_rect(fill = "#f8f9fa", color = NA),
      strip.text = element_text(face = "bold", size = 10, color = "#34495e"),
      panel.grid.major = element_line(color = "#f0f0f0"),
      panel.grid.minor = element_blank(),
      axis.title = element_text(size = 9, face = "italic"),
      axis.text = element_text(color = "#626d6e")
    )
}
```


###Wprowadzenie
W tym rozdziale skupiam się na analizie rozkładów i podstawowych statystyk wskaźników turystycznych oraz ekonomicznych. Analiza obejmuje skale wartości, niezbędne transformacje oraz wstępne badanie korelacji między zmiennymi.

###Podstawowa struktura danych

```{r}
df <- read_csv("../data/clean/world_tourism_economy_data_clean.csv")

glimpse(df)

df %>%
summarise(
Liczba_wierszy = n(),
Liczba_krajow = n_distinct(country),
Rok_od = min(year, na.rm = TRUE),
Rok_do = max(year, na.rm = TRUE)
)


```

###Statystyki opisowe

```{r}
kolumny_analiza <- c(
"tourism_arrivals", "tourism_receipts", "tourism_expenditures",
"tourism_exports", "tourism_departures", "gdp",
"inflation", "unemployment"
)

statystyki <- df %>%
  select(all_of(kolumny_analiza)) %>%
  pivot_longer(everything(), names_to = "Zmienna_kod", values_to = "Wartosc") %>%
  group_by(Zmienna_kod) %>%
  summarise(
    N = sum(!is.na(Wartosc)),
    Srednia = mean(Wartosc, na.rm = TRUE),
    Odch_std = sd(Wartosc, na.rm = TRUE),
    Min = min(Wartosc, na.rm = TRUE),
    Q1 = quantile(Wartosc, 0.25, na.rm = TRUE),
    Mediana = median(Wartosc, na.rm = TRUE),
    Q3 = quantile(Wartosc, 0.75, na.rm = TRUE),
    Max = max(Wartosc, na.rm = TRUE),
    .groups = "drop"
)

statystyki

```


```{r}
Sys.setenv(CHROMOTE_CHROME = "C:\\Users\\lucja\\AppData\\Local\\BraveSoftware\\Brave-Browser\\Application\\brave.exe")

statystyki_formatted <- statystyki %>%
  mutate(scale = unname(var_scale[Zmienna_kod])) %>%
  mutate(across(
    c(Srednia, Odch_std, Min, Q1, Mediana, Q3, Max),
    ~ . / scale
)) %>%
mutate(
  Wskaznik = label_var(Zmienna_kod),
  Wskaznik = case_when(
  Zmienna_kod %in% c("gdp", "tourism_receipts") ~ paste0(Wskaznik, " (mld)"),
  Zmienna_kod %in% c("tourism_arrivals", "tourism_departures") ~ paste0(Wskaznik, " (mln)"),
    TRUE ~ Wskaznik
)
)

statystyki_prezentacja <- statystyki_formatted %>%
  select(Wskaznik, N, Srednia, Odch_std, Min, Q1, Mediana, Q3, Max, Zmienna_kod) %>%
  gt() %>%
  tab_header(
    title = md("**Statystyki opisowe kluczowych wskaźników**"),
    subtitle = "Zestawienie zbiorcze po skalowaniu jednostek"
  ) %>%
  cols_label(
    Wskaznik = "Wskaźnik",
    N = "N",
    Srednia = "Średnia",
    Odch_std = "Odch. std.",
    Min = "Min",
    Q1 = "Q1",
    Mediana = "Mediana",
    Q3 = "Q3",
    Max = "Max",
    Zmienna_kod = "Kod"
  ) %>%
  fmt_number(
    columns = -c(Wskaznik, Zmienna_kod, N),
    decimals = 2,
    dec_mark = ",",
    sep_mark = " "
  ) %>%
  tab_row_group(
    label = "Wskaźniki makroekonomiczne",
    rows = Zmienna_kod %in% c("gdp", "inflation", "unemployment")
  ) %>%
  tab_row_group(
    label = "Ruch turystyczny i wydatki",
    rows = !Zmienna_kod %in% c("gdp", "inflation", "unemployment")
  ) %>%
  tab_options(
    column_labels.background.color = "#f9f9f9",
    column_labels.font.weight = "bold",
    table.font.size = px(14),
    data_row.padding = px(5),
    table.border.top.style = "none",
    table.border.bottom.style = "solid",
    table.border.bottom.width = px(2),
    table.border.bottom.color = "black",
    table.width = pct(100)
  ) %>%
  cols_align(align = "left", columns = Wskaznik) %>%
  cols_align(
    align = "center",
    columns = c(N, Srednia, Odch_std, Min, Q1, Mediana, Q3, Max, Zmienna_kod)
  )

gtsave(statystyki_prezentacja, "../outputs/statystyki_opisowe.png")

```

###Analiza trendów

```{r}
srednie_roczne <- df %>%
  group_by(year) %>%
    summarise(across(all_of(kolumny_analiza), ~ mean(., na.rm = TRUE)), .groups = "drop")

head(srednie_roczne)

```

```{r}
srednie_roczne <- df %>%
  group_by(year) %>%
  summarise(across(all_of(kolumny_analiza), ~ mean(., na.rm = TRUE))) %>%
  ungroup()


srednie_roczne_long <- srednie_roczne %>%
  pivot_longer(
    cols = -year,
    names_to = "Zmienna_kod",
    values_to = "Wartosc"
  ) %>%
  mutate(
    Zmienna = label_var(Zmienna_kod)
  )


srednie_roczne_gt <- srednie_roczne_long %>%
  gt() %>%
  tab_header(
    title = "Średnie roczne wartości wskaźników",
    subtitle = "Ujęcie zagregowane dla analizowanej próby"
  ) %>%
  cols_label(
    year = "Rok",
    Zmienna = "Wskaźnik",
    Wartosc = "Wartość"
  ) %>%
  fmt_integer(
    columns = year,
    sep_mark = ""        
  ) %>%
  fmt_number(
    columns = Wartosc,
    decimals = 2,
    sep_mark = " ",
    dec_mark = ","
  ) %>%
  tab_options(
    table.width = pct(100),
    table.font.size = px(10),
    column_labels.font.size = px(10),
    data_row.padding = px(4)
  )


gtsave(
  srednie_roczne_gt,
  "../outputs/srednie_roczne_glowne_wskazniki.png",
  vwidth = 1200,
  vheight = 1600,
  zoom = 2
)


```
###Rozkład zmiannych

```{r}
df_long <- df %>%
  select(all_of(kolumny_analiza)) %>%
    pivot_longer(everything(), names_to = "zmienna_kod", values_to = "wartosc") %>%
    mutate(zmienna = label_var(zmienna_kod))
```

```{r}
#wartosci surowe

hist_raw <- ggplot(df_long, aes(x = wartosc)) +
  geom_histogram(bins = 30, fill = kolor_blekit, color = "white", alpha = 0.9) +
  facet_wrap(~ zmienna, scales = "free", labeller = labeller(zmienna = c(
    "gdp" = "PKB", "inflation" = "Inflacja", "tourism_arrivals" = "Przyjazdy",
    "tourism_departures" = "Wyjazdy", "tourism_expenditures" = "Wydatki (% PKB)",
    "tourism_exports" = "Eksport", "tourism_receipts" = "Przychody", "unemployment" = "Bezrobocie"
  ))) +
  theme_inz() +
  labs(
    title = "Rozkłady wskaźników (wartości surowe)",
    subtitle = "Wstępna wizualizacja danych przed transformacją",
    x = "Wartość surowa", y = "Liczba obserwacji"
  )

ggsave("../outputs/hist_raw.png", hist_raw, width = 12, height = 8, dpi = 300)
```

```{r}
#log

hist_log <- ggplot(df_long %>% filter(wartosc > 0), aes(x = log10(wartosc))) +
  geom_histogram(bins = 30, fill = kolor_granat, color = "white", alpha = 0.9) +
  facet_wrap(~ zmienna, scales = "free", labeller = labeller(zmienna = c(
    "gdp" = "log10(PKB)", "inflation" = "log10(Inflacja)", "tourism_arrivals" = "log10(Przyjazdy)",
    "tourism_departures" = "log10(Wyjazdy)", "tourism_expenditures" = "log10(Wydatki)",
    "tourism_exports" = "log10(Eksport)", "tourism_receipts" = "log10(Przychody)", "unemployment" = "log10(Bezrobocie)"
  ))) +
  theme_inz() +
  labs(
    title = "Rozkłady wskaźników po transformacji logarytmicznej",
    subtitle = "Zastosowanie skali log10 w celu uzyskania rozkładów zbliżonych do normalnego",
    x = "Wartość (skala log10)", y = "Liczba obserwacji"
  )

ggsave("../outputs/hist_log.png", hist_log, width = 12, height = 8, dpi = 300)
```

###Analiza korelacji

```{r}
mat_kor <- df %>%
  select(all_of(kolumny_analiza)) %>%
  cor(use = "pairwise.complete.obs")

kor_long <- as.data.frame(mat_kor) %>%
  rownames_to_column("v1_kod") %>%
  pivot_longer(-v1_kod, names_to = "v2_kod", values_to = "r") %>%
  mutate(
    v1 = label_var(v1_kod),
    v2 = label_var(v2_kod)
)

wykres_kor <- ggplot(kor_long, aes(v1, v2, fill = r)) +
  geom_tile(color = "white", linewidth = 0.5) +
  scale_fill_gradient2(
    low = "#d88a8a",
    mid = "white",
    high = kolor_granat,
    limit = c(-1, 1),
    name = "Korelacja Pearsona"
) +
theme_inz() +
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1, vjust = 1),
    axis.title = element_blank(),
    panel.grid.major = element_blank()
) +
labs(title = "Macierz korelacji wskaźników") +
  geom_text(
    aes(label = sprintf("%.2f", r)),
      size = 3,
        color = ifelse(abs(kor_long$r) > 0.5, "white", "black")
)

ggsave("../outputs/heatmapa_korelacji.png", wykres_kor, width = 10, height = 8, dpi = 300)
```

###Kluczowe zalezności i kraje

```{r}

wykres_rozrzutu <- df %>%
  filter(gdp > 0, tourism_arrivals > 0) %>%
  ggplot(aes(x = log10(gdp), y = log10(tourism_arrivals))) +
  geom_point(alpha = 0.25, color = kolor_granat, size = 1.5) +
  geom_smooth(method = "lm", color = "#1a1a1a", fill = "grey80", alpha = 0.2, size = 1.2) +
  theme_inz() +
  labs(
    title = "Zależność między PKB a ruchem turystycznym",
    subtitle = "Analiza w skali logarytmicznej (log10) dla wszystkich obserwacji",
    x = "PKB (log10 USD)",
    y = "Liczba przyjazdów (log10 osób)",
  ) +
  theme(
    panel.grid.minor = element_line(color = "#f5f5f5", linetype = "dotted")
  )

ggsave("../outputs/scatter_log_pkb_przyjazdy.png", wykres_rozrzutu, width = 10, height = 7, dpi = 300)
```

```{r}
ranking_turystyka <- df %>%
  filter(tourism_receipts > 0, gdp > 0) %>%
  mutate(udzial = (tourism_receipts / gdp) * 100) %>%
  group_by(country) %>%
  summarise(Sredni_udzial_PKB = mean(udzial, na.rm = TRUE)) %>%
  arrange(desc(Sredni_udzial_PKB)) %>%
  slice_head(n = 10) %>%
  mutate(Sredni_udzial_PKB = round(Sredni_udzial_PKB, 2))
```

```{r}
ranking_gt <- ranking_turystyka %>%
  gt() %>%
  tab_header(
    title = md("**Top 10 krajów o najwyższym udziale turystyki w PKB**"),
    subtitle = "Średnia wartość procentowa przychodów z turystyki względem PKB"
  ) %>%
  cols_label(
    country = "Kraj",
    Sredni_udzial_PKB = "Średni udział (%)"
  ) %>%
  fmt_number(
    Sredni_udzial_PKB,
    decimals = 2,
    dec_mark = ",",
    sep_mark = " "
  ) %>%
  tab_options(
    column_labels.background.color = "#f9f9f9",
    column_labels.font.weight = "bold",
    table.font.size = px(14),
    data_row.padding = px(5),
    table.border.top.style = "none",
    table.border.bottom.style = "solid",
    table.border.bottom.width = px(2),
    table.border.bottom.color = "black",
    table.width = pct(60)
  ) %>%
  cols_align(align = "left", columns = country) %>%
  cols_align(align = "center", columns = Sredni_udzial_PKB)

gtsave(ranking_gt, "../outputs/top_10_udzial_turystyki.png")

```

###Trenmdy czasowe

```{r}
df_trend_long <- df %>%
  group_by(year) %>%
  summarise(
    "Przyjazdy (mln)" = mean(tourism_arrivals, na.rm = TRUE) / 1e6,
    "Przychody (mld USD)" = mean(tourism_receipts, na.rm = TRUE) / 1e9,
    "PKB (mld USD)" = mean(gdp, na.rm = TRUE) / 1e9
  ) %>%
  pivot_longer(-year, names_to = "wskaźnik", values_to = "wartość") %>%
  filter(!is.na(year))
```

```{r}
wykres_trendow <- ggplot(df_trend_long, aes(x = year, y = wartość, color = wskaźnik)) +
  geom_line(linewidth = 1.1) +
  geom_point(size = 1.5, alpha = 0.7) +
  facet_wrap(~ wskaźnik, scales = "free_y", ncol = 3) +
  scale_color_manual(values = c(
    "PKB (mld USD)" = kolor_granat, 
    "Przyjazdy (mln)" = kolor_blekit,
    "Przychody (mld USD)" = "#546e7a"
  )) +
  theme_inz() +
  theme(
    legend.position = "none", 
    strip.text = element_text(size = 11, face = "bold"),
    panel.spacing = unit(1.5, "lines")
  ) +
  labs(
    title = "Ewolucja średnich wskaźników gospodarczych i turystycznych",
    subtitle = "Analiza trendów czasowych (wartości zagregowane rocznie)",
    x = "Rok",
    y = "Średnia wartość"
  )

ggsave("../outputs/trend_wskaźniki_fasetowy.png", wykres_trendow, width = 12, height = 6, dpi = 300)

```
