---
title: "Eksploracyjna analiza danych – struktura i braki"
author: "Łucja Wuls"
date: "2025-11-06"
---

# Wstęp

Celem tego notebooka jest wstępne poznanie struktury zbioru danych przygotowanego na etapie czyszczenia oraz analiza występowania braków danych po stronie zmiennych turystycznych i makroekonomicznych.
Pracujemy na pliku `world_tourism_economy_data_clean.csv` zapisanym w katalogu `data/clean`.

# Przygotowanie środowiska

```{r}
knitr::opts_chunk$set(
  echo = TRUE,
  message = FALSE,
  warning = FALSE
)
```

```{r packages}
# Pakiety potrzebne w tej części EDA.
# tidyverse – dplyr, readr, ggplot2 itd.
# janitor – dodatkowe narzędzia do pracy z tabelami.
# skimr – zwięzłe podsumowanie struktury danych.
# naniar – wygodne funkcje do pracy z brakami danych.

library(tidyverse)
library(janitor)
library(skimr)
library(naniar)
```

# Wczytanie danych

```{r}
# Ścieżka do wyczyszczonego zbioru.
clean_path <- "data/clean/world_tourism_economy_data_clean.csv"

# Wczytanie danych.
tourism <- readr::read_csv(clean_path, show_col_types = FALSE)

# Podgląd pierwszych obserwacji – kontrolnie.
head(tourism)
```

```{r}
# Szybka struktura danych: liczba wierszy i kolumn, typy zmiennych.
glimpse(tourism)
```

# Struktura zbioru i podstawowe charakterystyki

## Liczba krajów, lat i obserwacji

```{r}
# Liczba obserwacji i kolumn.
nrow(tourism)
ncol(tourism)

# Zestaw głównych zmiennych identyfikacyjnych.
id_vars <- c("country", "country_code", "year")

id_vars

# Liczba unikalnych krajów.
n_distinct(tourism$country)

# Zakres lat w zbiorze.
range(tourism$year, na.rm = TRUE)
```

```{r}
# Proste podsumowanie: ile lat ma każdy kraj.
years_per_country <- tourism %>%
  count(country, name = "n_years") %>%
  arrange(desc(n_years))

head(years_per_country, 10)

# Rozkład liczby lat na kraj (czy panel jest w przybliżeniu zbalansowany).
years_per_country %>%
  tabyl(n_years)
```

```{r}
# Zwięzłe podsumowanie struktury i typów zmiennych. Pozwala szybko zobaczyć m.in. odsetek braków w każdej kolumnie.
skim(tourism)
```

# Analiza braków danych

## Zmienne kluczowe i ich brakujące wartości

```{r}
# Definiujemy zestaw zmiennych ilościowych, które będą analizowane pod kątem braków.
measure_vars <- c(
  "tourism_receipts",
  "tourism_arrivals",
  "tourism_exports",
  "tourism_departures",
  "tourism_expenditures",
  "gdp",
  "inflation",
  "unemployment"
)

measure_vars
```

```{r}
# Tabela z liczbą i odsetkiem braków danych dla każdej zmiennej ilościowej.

missing_summary <- tourism %>%
  summarise(
    across(
      .cols = all_of(measure_vars),
      .fns = list(
        n_missing = ~ sum(is.na(.)),
        pct_missing = ~ mean(is.na(.)) * 100
      ),
      .names = "{.col}_{.fn}"
    )
  ) %>%
  pivot_longer(
    cols = everything(),
    names_to = c("variable", ".value"),
    names_sep = "_(?=[np]ct_missing)"
  ) %>%
  arrange(desc(pct_missing))

missing_summary
```

```{r}
# Wykres słupkowy odsetka braków danych. Ułatwia szybkie porównanie, które zmienne są dobrze wypełnione, a które mocno „dziurawe”.

missing_summary %>%
  ggplot(aes(x = reorder(variable, pct_missing), y = pct_missing)) +
  geom_col() +
  coord_flip() +
  labs(
    x = "Zmienna",
    y = "Odsetek braków danych [%]",
    title = "Braki danych w zmiennych turystycznych i makroekonomicznych"
  )
```


## Wzorce braków – czy braki skupiają się w określonych okresach lub krajach?

```{r}
# Odsetek braków w każdej zmiennej w podziale na lata. Pozwala sprawdzić, czy braki koncentrują się w początkowych / końcowych latach.

missing_by_year <- tourism %>%
  group_by(year) %>%
  summarise(
    across(
      .cols = all_of(measure_vars),
      .fns = ~ mean(is.na(.)) * 100,
      .names = "{.col}"
    )
  )

missing_by_year
```

```{r}
# Wykres: odsetek braków w wybranych zmiennych w czasie.

missing_by_year %>%
  select(year, gdp, tourism_arrivals, tourism_receipts) %>%
  pivot_longer(
    cols = -year,
    names_to = "variable",
    values_to = "pct_missing"
  ) %>%
  ggplot(aes(x = year, y = pct_missing, color = variable)) +
  geom_line() +
  labs(
    x = "Rok",
    y = "Odsetek braków [%]",
    color = "Zmienna",
    title = "Braki danych w czasie dla wybranych zmiennych"
  )
```

```{r}
# Odsetek braków w wybranych zmiennych w podziale na kraje. Można wykorzystać do zidentyfikowania krajów o bardzo słabej jakości danych.

missing_by_country <- tourism %>%
  group_by(country) %>%
  summarise(
    across(
      .cols = all_of(measure_vars),
      .fns = ~ mean(is.na(.)) * 100,
      .names = "{.col}"
    )
  )

head(missing_by_country)
```


# Sprawdzenie duplikatów

```{r}
# Sprawdzamy, czy po czyszczeniu występują jakiekolwiek duplikaty

duplicates <- tourism %>%
  count(country, country_code, year, name = "n") %>%
  filter(n > 1)

duplicates
```

